// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "./node_modules/@prisma/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement()) @map("user_id")
  name          String?
  email         String   @unique
  password_hash String?
  image         String?
  provider      String?  @default("credentials")
  createdAt     DateTime @default(now())

  // relation fields
  testRecords         TestRecord[]
  performanceAnalysis PerformanceAnalysis?
}

model Question {
  question_id    Int        @id @default(autoincrement())
  subject        String
  topic          String
  difficulty     Difficulty
  question_text  String
  correct_option String
  option_1       String
  option_2       String
  option_3       String
  option_4       String

  testRecords TestRecord[]
}

model TestRecord {
  attempt_id Int @id @default(autoincrement())

  user_id Int
  user    User @relation(fields: [user_id], references: [id])

  question_id Int
  question    Question @relation(fields: [question_id], references: [question_id])

  selected_option String
  correct         Boolean
  time_taken      Int
  test_date       DateTime @default(now())
}

model PerformanceAnalysis {
  user_id Int  @id
  user    User @relation(fields: [user_id], references: [id])

  total_tests     Int       @default(0)
  avg_score       Float     @default(0)
  weak_topics     String?
  strength_topics String?
  last_attempt    DateTime?
}

enum Difficulty {
  Easy
  Medium
  Hard
}
